# Архитектура FinAggregator

## Обзор

FinAggregator - это масштабируемое решение для агрегации финансовых данных из различных банков через Open Banking API.

## Компоненты системы

### Backend (FastAPI)

#### Модули:
1. **API Endpoints** (`app/api/v1/endpoints/`)
   - `auth.py` - Аутентификация и авторизация
   - `accounts.py` - Управление счетами
   - `transactions.py` - Транзакции
   - `banks.py` - Подключение банков
   - `products.py` - Рекомендации продуктов
   - `ai.py` - ИИ ассистент
   - `subscription.py` - Управление подпиской

2. **Services** (`app/services/`)
   - `bank_adapter.py` - Адаптеры для банковских API
   - `ai_assistant.py` - ИИ ассистент для анализа
   - `categorizer.py` - Категоризация транзакций

3. **Database Models** (`app/db/models.py`)
   - User - Пользователи
   - Bank - Банки
   - BankConnection - Подключения к банкам
   - Account - Счета
   - Transaction - Транзакции
   - ProductRecommendation - Рекомендации продуктов
   - AIChatMessage - Сообщения ИИ чата

### Frontend (React + TypeScript)

#### Страницы:
1. **Dashboard** - Главная страница с обзором финансов
2. **Accounts** - Управление счетами
3. **Transactions** - История транзакций
4. **Products** - Рекомендации продуктов
5. **AIAssistant** - ИИ ассистент (Premium)
6. **Subscription** - Управление подпиской

#### Компоненты:
- `Layout` - Основной layout с навигацией
- `AuthContext` - Контекст аутентификации

## Интеграция с банковскими API

### Процесс подключения банка:

1. **Аутентификация** - Получение access token от банка
2. **Запрос согласия** - Создание consent для доступа к данным
3. **Синхронизация счетов** - Получение списка счетов
4. **Синхронизация транзакций** - Получение транзакций

### Поддерживаемые банки:
- VBank
- ABank (Awesome Bank)
- SBank (Smart Bank)

## Масштабируемость

### Добавление нового банка:

1. Создать новый адаптер в `bank_adapter.py`, наследующий `BankAdapter`
2. Добавить банк в базу данных через `init_db.py`
3. Настроить параметры в `.env`

### Добавление новых функций:

1. Создать новый endpoint в `app/api/v1/endpoints/`
2. Добавить соответствующую страницу во frontend
3. Обновить навигацию в `Layout.tsx`

## Безопасность

- JWT токены для аутентификации
- Хеширование паролей (bcrypt)
- Валидация данных через Pydantic
- CORS настройки
- Проверка прав доступа к данным пользователя

## Монетизация

- **Бесплатный план**: Базовая функциональность
- **Premium план** (999₽/мес): ИИ ассистент, продвинутая аналитика

## Производительность

- Кэширование через Redis (готово к реализации)
- Асинхронная обработка запросов
- Индексы в базе данных
- Пагинация для больших списков

## Развертывание

### Docker Compose:
- PostgreSQL - База данных
- Redis - Кэширование
- Backend - FastAPI приложение
- Frontend - React приложение

### Переменные окружения:
См. `.env.example` для списка всех необходимых переменных.

## Дальнейшее развитие

1. Интеграция с платежными системами для подписки
2. Расширенная аналитика и отчеты
3. Мобильное приложение
4. Экспорт данных в различные форматы
5. Уведомления и напоминания
6. Бюджетирование и планирование

