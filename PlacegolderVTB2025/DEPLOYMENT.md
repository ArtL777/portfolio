# Инструкция по развертыванию FinAggregator

## Требования

- Docker и Docker Compose
- Python 3.11+ (для локальной разработки)
- Node.js 18+ (для локальной разработки)
- PostgreSQL 15+ (если не используете Docker)
- Redis 7+ (если не используете Docker)

## Быстрый старт с Docker

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd finaggregator
```

2. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

3. Заполните необходимые переменные окружения в `.env`:
   - `DATABASE_URL` - URL базы данных PostgreSQL
   - `REDIS_URL` - URL Redis
   - `OPENAI_API_KEY` - API ключ OpenAI (опционально, для ИИ ассистента)
   - Настройки банковских API (VBANK, ABANK, SBANK)
   - `JWT_SECRET_KEY` - Секретный ключ для JWT токенов

4. Запустите приложение:
```bash
docker-compose up -d
```

5. Приложение будет доступно по адресам:
   - Frontend: http://localhost:3000
   - Backend API: http://localhost:8000
   - API Документация: http://localhost:8000/docs

## Локальная разработка

### Backend

1. Перейдите в директорию backend:
```bash
cd backend
```

2. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл `.env` в директории `backend`:
```bash
DATABASE_URL=postgresql://finaggregator:finaggregator@localhost:5432/finaggregator
REDIS_URL=redis://localhost:6379
OPENAI_API_KEY=your_openai_api_key
# ... другие переменные
```

5. Запустите сервер разработки:
```bash
uvicorn app.main:app --reload
```

### Frontend

1. Перейдите в директорию frontend:
```bash
cd frontend
```

2. Установите зависимости:
```bash
npm install
```

3. Создайте файл `.env` в директории `frontend`:
```bash
VITE_API_URL=http://localhost:8000/api/v1
```

4. Запустите сервер разработки:
```bash
npm start
```

## Настройка базы данных

База данных инициализируется автоматически при первом запуске приложения. Если нужно инициализировать вручную:

```bash
cd backend
python -m app.db.init_db
```

## Настройка банковских API

1. Получите учетные данные для каждого банка (client_id, client_secret)
2. Настройте URL API каждого банка
3. Добавьте эти данные в `.env` файл

## Проверка работы

1. Зарегистрируйте нового пользователя через `/register`
2. Войдите в систему через `/login`
3. Подключите банк через интерфейс приложения
4. Синхронизируйте данные со счетов
5. Проверьте отображение транзакций и аналитики

## Производственное развертывание

1. Используйте переменные окружения для конфигурации
2. Настройте HTTPS для безопасности
3. Используйте обратный прокси (nginx) для фронтенда
4. Настройте мониторинг и логирование
5. Используйте CI/CD для автоматического развертывания
6. Настройте резервное копирование базы данных

## Устранение неполадок

### Проблемы с подключением к базе данных
- Проверьте, что PostgreSQL запущен
- Проверьте правильность DATABASE_URL
- Убедитесь, что база данных создана

### Проблемы с банковскими API
- Проверьте правильность URL и учетных данных
- Убедитесь, что банковские API доступны
- Проверьте логи backend для деталей ошибок

### Проблемы с ИИ ассистентом
- Проверьте, что OPENAI_API_KEY установлен
- Убедитесь, что у вас есть активная подписка Premium
- Проверьте логи для ошибок API

## Поддержка

Для вопросов и проблем обращайтесь к документации или создайте issue в репозитории.

